<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="highlight-light-theme">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="highlight-dark-theme">
    
    <!-- æ—©æœŸæ–‡ä»¶å…³è”ç›‘å¬å™¨ -->
    <script>
        // è®¾ç½®å…¨å±€æ–‡ä»¶å…³è”æ ‡å¿—
        window.hasFileAssociationContent = false;
        
        // æ—©æœŸæ–‡ä»¶å…³è”ç›‘å¬å™¨
        function setupEarlyFileAssociationListener() {
            if (window.__TAURI__) {
                console.log('è®¾ç½®æ—©æœŸæ–‡ä»¶å…³è”ç›‘å¬å™¨');
                window.__TAURI__.event.listen('open-file', (event) => {
                    console.log('æ—©æœŸç›‘å¬å™¨æ”¶åˆ°æ–‡ä»¶å…³è”äº‹ä»¶:', event.payload);
                    window.hasFileAssociationContent = true;
                    console.log('æ—©æœŸç›‘å¬å™¨è®¾ç½®æ–‡ä»¶å…³è”æ ‡å¿—');
                });
            } else {
                console.log('Tauri APIä¸å¯ç”¨ï¼Œç­‰å¾…åŠ è½½...');
                setTimeout(setupEarlyFileAssociationListener, 50);
            }
        }
        
        // ç«‹å³å°è¯•è®¾ç½®ç›‘å¬å™¨
        setupEarlyFileAssociationListener();
    </script>
    
    <script>
        // ç­‰å¾…highlight.jsåŠ è½½å®Œæˆåæ³¨å†Œè¯­è¨€
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof hljs !== 'undefined') {
                console.log('highlight.jså·²åŠ è½½ï¼Œæ³¨å†Œè¯­è¨€æ”¯æŒ');
                
                // æ‰‹åŠ¨æ³¨å†Œè¯­è¨€ï¼ˆå¦‚æœè‡ªåŠ¨æ³¨å†Œå¤±è´¥ï¼‰
                if (hljs.registerLanguage) {
                    console.log('ä½¿ç”¨registerLanguageæ³¨å†Œè¯­è¨€');
                } else {
                    console.log('highlight.jsè¯­è¨€å·²è‡ªåŠ¨æ³¨å†Œ');
                }
                
                // æ£€æŸ¥æ”¯æŒçš„è¯­è¨€
                console.log('æ”¯æŒçš„è¯­è¨€æ•°é‡:', Object.keys(hljs.listLanguages()).length);
                console.log('æ”¯æŒçš„è¯­è¨€:', hljs.listLanguages());
            } else {
                console.error('highlight.jsæœªåŠ è½½');
            }
        });
    </script>
    
    <!-- Mermaid for flowcharts -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
        <div class="toolbar">
            <div class="toolbar-section toolbar-left">
                <div class="toolbar-group">
                    <div class="dropdown">
                        <button id="new-btn" class="btn btn-primary dropdown-toggle" title="æ–°å»ºæ–‡æ¡£ (Ctrl+N)">
                            <span class="icon">ğŸ“„</span>
                            æ–°å»º
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="dropdown-menu">
                            <button id="new-blank" class="dropdown-item">
                                <span class="icon">ğŸ“„</span>
                                åˆ›å»ºç©ºç™½æ–‡æ¡£
                            </button>
                            <button id="new-template" class="dropdown-item">
                                <span class="icon">ğŸ“‹</span>
                                ä½¿ç”¨é»˜è®¤æ¨¡æ¿
                            </button>
                        </div>
                    </div>
                    <button id="open-btn" class="btn" title="æ‰“å¼€æ–‡ä»¶ (Ctrl+O)">
                        <span class="icon">ğŸ“‚</span>
                        æ‰“å¼€
                    </button>
                    <button id="save-btn" class="btn" title="ä¿å­˜æ–‡ä»¶ (Ctrl+S)">
                        <span class="icon">ğŸ’¾</span>
                        ä¿å­˜
                    </button>
                    <button id="save-as-btn" class="btn" title="å¦å­˜ä¸º (Ctrl+Shift+S)">
                        <span class="icon">ğŸ“</span>
                        å¦å­˜ä¸º
                    </button>
                </div>
            </div>
            
            <div class="toolbar-section toolbar-center">
                <div class="toolbar-group">
                    <!-- æ’¤é”€é‡åšåŠŸèƒ½å·²ç§»é™¤ -->
                </div>
            </div>
            
            <div class="toolbar-section toolbar-right">
                <div class="toolbar-group">
                    <button id="sync-btn" class="btn btn-sync" title="åŒæ­¥æ»šåŠ¨ (Ctrl+Shift+S)">
                        <span class="icon">ğŸ”—</span>
                        <span class="btn-text">åŒæ­¥</span>
                    </button>
                    <button id="export-btn" class="btn" title="å¯¼å‡ºä¸ºHTML">
                        <span class="icon">ğŸ“¤</span>
                        å¯¼å‡º
                    </button>
                    <button id="fullscreen-btn" class="btn" title="å…¨å±é¢„è§ˆ (F11)">
                        <span class="icon">â›¶</span>
                        å…¨å±
                    </button>
                    <div class="theme-selector">
                        <select id="theme-select">
                            <option value="light">æµ…è‰²</option>
                            <option value="dark">æ·±è‰²</option>
                            <option value="auto">è‡ªåŠ¨</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <main class="main-content">
            <div class="editor-container">
                <textarea 
                    id="markdown-editor" 
                    placeholder="å¼€å§‹ç¼–å†™ä½ çš„ Markdown å†…å®¹..."
                    spellcheck="false"
                ></textarea>
            </div>
            <div class="preview-container">
                <div id="markdown-preview"></div>
            </div>
        </main>
    </div>
    
    <!-- æœ€è¿‘æ–‡ä»¶é¢æ¿ -->
    <div id="recent-files-modal" class="recent-files-modal" aria-hidden="true">
        <div class="recent-files-dialog" role="dialog" aria-modal="true" aria-labelledby="recent-files-title">
            <div class="recent-files-header">
                <h3 id="recent-files-title">æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶</h3>
                <button id="recent-files-close" class="btn btn-secondary btn-small" type="button" title="å…³é—­ (Esc)">
                    å…³é—­
                </button>
            </div>
            <div class="recent-files-body">
                <p id="recent-files-empty">æš‚æ— æœ€è¿‘è®°å½•</p>
                <ul id="recent-files-list" class="recent-files-list" role="list"></ul>
            </div>
            <div class="recent-files-footer">
                <span class="recent-files-hint">å¿«æ·é”®ï¼šCtrl + Shift + R</span>
            </div>
        </div>
    </div>

    <!-- é“¾æ¥æ–‡ä»¶é¢„è§ˆé¢æ¿ -->
    <div id="linked-file-modal" class="linked-file-modal" aria-hidden="true">
        <div class="linked-file-dialog" role="dialog" aria-modal="true" aria-labelledby="linked-file-title" tabindex="-1">
            <div class="linked-file-header">
                <div>
                    <h3 id="linked-file-title">é“¾æ¥æ–‡ä»¶é¢„è§ˆ</h3>
                    <p id="linked-file-path" class="linked-file-path"></p>
                </div>
                <button id="linked-file-close" class="btn btn-secondary btn-small" type="button" title="å…³é—­ (Esc)">
                    å…³é—­
                </button>
            </div>
            <div class="linked-file-body">
                <div id="linked-file-content" class="linked-file-content"></div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>